!function(t){var n={};function e(r){if(n[r])return n[r].exports;var o=n[r]={i:r,l:!1,exports:{}};return t[r].call(o.exports,o,o.exports,e),o.l=!0,o.exports}e.m=t,e.c=n,e.d=function(t,n,r){e.o(t,n)||Object.defineProperty(t,n,{enumerable:!0,get:r})},e.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},e.t=function(t,n){if(1&n&&(t=e(t)),8&n)return t;if(4&n&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(e.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&n&&"string"!=typeof t)for(var o in t)e.d(r,o,function(n){return t[n]}.bind(null,o));return r},e.n=function(t){var n=t&&t.__esModule?function(){return t.default}:function(){return t};return e.d(n,"a",n),n},e.o=function(t,n){return Object.prototype.hasOwnProperty.call(t,n)},e.p="/",e(e.s=3)}([function(t,n){t.exports=require("fs")},function(t,n){t.exports=require("express")},function(t,n){t.exports=require("path")},function(t,n,e){var r=e(1),o=e(0),i=e(4),u=r(),c=e(7),s=e(2);u.use(r.json()),u.use("/",r.static(s.resolve(__dirname,"../public"))),u.use("/api/cart",i);var d=s.resolve(__dirname,"./db/catalog.json"),a=s.resolve(__dirname,"./db/products.json"),f=s.resolve(__dirname,"./db/good.json");u.get("/api/products",(function(t,n){o.readFile(a,"utf-8",(function(t,e){t?n.send(JSON.stringify({result:0,text:t})):n.send(e)}))})),u.get("/api/catalog",(function(t,n){o.readFile(d,"utf-8",(function(t,e){t?n.send(JSON.stringify({result:0,text:t})):n.send(e)}))})),u.get("/api/good",(function(t,n){o.readFile(f,"utf-8",(function(t,e){t?n.send(JSON.stringify({result:0,text:t})):n.send(e)}))})),u.get("/api/open/:id",(function(t,n){o.readFile(d,"utf-8",(function(e,r){if(e)console.log(e),n.sendStatus(404,JSON.stringify({result:0,text:e}));else{var i=JSON.parse(r);o.readFile(a,"utf-8",(function(e,r){if(e)console.log(e),n.sendStatus(404,JSON.stringify({result:0,text:e}));else{var u=JSON.parse(r);o.readFile(f,"utf-8",(function(e,r){if(e)console.log(e),n.sendStatus(404,JSON.stringify({result:0,text:e}));else{var s=JSON.parse(r),d=c(s,i,u,t);o.writeFile(f,d,(function(t){t?n.send('{"result": 0}'):n.send('{"result": 1}')}))}}))}}))}}))}));var l=process.env.PORT||3e3;u.listen(l,(function(){console.log("Listening ".concat(l," port"))}))},function(t,n,e){var r=e(1),o=e(0),i=e(5),u=r.Router(),c=e(2).resolve(__dirname,"./db/userCart.json");u.get("/",(function(t,n){o.readFile(c,"utf-8",(function(t,e){t?n.sendStatus(404,JSON.stringify({result:0,text:t})):n.send(e)}))})),u.post("/",(function(t,n){i(t,n,"add",c)})),u.put("/:id",(function(t,n){i(t,n,"change",c)})),u.delete("/:id",(function(t,n){i(t,n,"del",c)})),u.purge("/",(function(t,n){i(t,n,"clr",c)})),u.checkout("/:id",(function(t,n){i(t,n,"checkout",c)})),t.exports=u},function(t,n,e){var r=e(0),o=e(6),i={add:o.add,change:o.change,del:o.del,clr:o.clr,checkout:o.checkout};t.exports=function(t,n,e,o){console.log(i[e]),r.readFile(o,"utf-8",(function(u,c){if(u)n.sendStatus(404,JSON.stringify({result:0,text:u}));else{var s=i[e](JSON.parse(c),t);r.writeFile(o,s,(function(t){t?n.send('{"result": 0}'):n.send('{"result": 1}')}))}}))}},function(t,n){t.exports={add:function(t,n){return t.contents.push(n.body),t.countGoods+=n.body.quantity,t.amount+=n.body.price*n.body.quantity,JSON.stringify(t,null,4)},change:function(t,n){return t.contents.find((function(t){return t.id_product===+n.params.id})).quantity+=n.body.quantity,t.countGoods+=n.body.quantity,t.amount+=n.body.price*n.body.quantity,JSON.stringify(t,null,4)},del:function(t,n){var e=t.contents.find((function(t){return t.id_product===+n.params.id}));return t.countGoods--,t.amount-=n.body.price,1===e.quantity?t.contents.splice(t.contents.indexOf(e),1):e.quantity-=n.body.quantity,JSON.stringify(t,null,4)},clr:function(t,n){return t.amount=0,t.countGoods=0,t.contents=[],JSON.stringify(t,null,4)},checkout:function(t,n){if(n.body.quantity>0){var e=t.contents.find((function(t){return t.id_product===+n.params.id})),r=+n.body.quantity-e.quantity;return e.quantity=+n.body.quantity,t.amount+=r*e.price,t.countGoods+=r,JSON.stringify(t,null,4)}return JSON.stringify(t,null,4)}}},function(t,n){t.exports=function(t,n,e,r){var o=n.find((function(t){return t.id_product===+r.params.id}));return o||(o=e.find((function(t){return t.id_product===+r.params.id}))),t.id_product=o.id_product,t.img=o.img,t.product_name=o.product_name,t.price=o.price,JSON.stringify(t,null,4)}}]);